<p-dialog
  [visible]="isOpen()"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '32rem' }"
  styleClass="glass-card"
  (onHide)="onClose()"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <i class="pi pi-user-plus text-primary text-2xl"></i>
      <h2 class="text-2xl font-bold text-white">Add Team Member</h2>
    </div>
  </ng-template>

  <!-- Error Message -->
  @if (errorMessage()) {
  <div class="bg-red-500/10 border border-red-500/50 rounded-lg p-4 mb-6">
    <div class="flex items-center gap-3 text-red-400">
      <i class="pi pi-exclamation-triangle text-xl"></i>
      <p class="text-sm">{{ errorMessage() }}</p>
    </div>
  </div>
  }

  <!-- Form -->
  <form [formGroup]="memberForm" (ngSubmit)="onSubmit()" class="space-y-4">
    <!-- Email -->
    <div class="space-y-2">
      <label for="email" class="block text-sm font-medium text-gray-300">
        Email Address <span class="text-red-400">*</span>
      </label>
      <input
        pInputText
        id="email"
        type="email"
        formControlName="email"
        placeholder="member@example.com"
        class="w-full"
        [class.ng-invalid]="hasError('email', 'required') || hasError('email', 'email')"
        [class.ng-dirty]="hasError('email', 'required') || hasError('email', 'email')"
      />
      @if (hasError('email', 'required') || hasError('email', 'email')) {
      <p class="text-red-400 text-sm">{{ getErrorMessage('email') }}</p>
      }
    </div>

    <!-- Display Name -->
    <div class="space-y-2">
      <label for="displayName" class="block text-sm font-medium text-gray-300">
        Display Name <span class="text-red-400">*</span>
      </label>
      <input
        pInputText
        id="displayName"
        type="text"
        formControlName="displayName"
        placeholder="John Doe"
        class="w-full"
        [class.ng-invalid]="hasError('displayName', 'required') || hasError('displayName', 'minlength')"
        [class.ng-dirty]="hasError('displayName', 'required') || hasError('displayName', 'minlength')"
      />
      @if (hasError('displayName', 'required') || hasError('displayName', 'minlength')) {
      <p class="text-red-400 text-sm">{{ getErrorMessage('displayName') }}</p>
      }
    </div>

    <!-- Role -->
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-300">
        Role <span class="text-red-400">*</span>
      </label>
      <div class="space-y-2">
        @for (role of roles; track role.value) {
        <label
          class="flex items-start gap-3 p-3 border rounded-lg cursor-pointer hover:bg-white/10 transition"
          [ngClass]="{
              'bg-white/5 border-white/10': memberForm.get('role')?.value !== role.value,
              'bg-primary/20 border-primary': memberForm.get('role')?.value === role.value
            }"
        >
          <p-radioButton
            [value]="role.value"
            formControlName="role"
            [inputId]="'role-' + role.value"
            styleClass="mt-1"
          />
          <div class="flex-1">
            <div class="font-medium text-white">{{ role.label }}</div>
            <div class="text-sm text-gray-400">{{ role.description }}</div>
          </div>
        </label>
        }
      </div>
    </div>

    <!-- Info Box -->
    <div class="bg-primary/10 border border-primary/30 rounded-lg p-4">
      <div class="flex gap-3">
        <i class="pi pi-info-circle text-primary text-lg flex-shrink-0"></i>
        <p class="text-sm text-gray-300">
          An invitation will be sent to the member's email address.
        </p>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3 pt-2">
      <button
        type="button"
        (click)="onClose()"
        class="flex-1 outer-button"
        [disabled]="isSubmitting()"
      >
        <i class="pi pi-times mr-2"></i>
        Cancel
      </button>
      <button
        type="submit"
        class="flex-1 inner-button"
        [disabled]="isSubmitting() || memberForm.invalid"
      >
        @if (isSubmitting()) {
        <i class="pi pi-spin pi-spinner mr-2"></i>
        Adding... } @else {
        <i class="pi pi-user-plus mr-2"></i>
        Add Member }
      </button>
    </div>
  </form>
</p-dialog>
