<div class="min-h-screen text-white flex flex-col">
  <div class="flex-1 px-3 sm:px-4 md:px-6 lg:px-8 py-3 sm:py-4 md:py-6">
    <main class="flex-1 space-y-6 sm:space-y-8 max-w-5xl mx-auto w-full">
      <!-- Header -->
      <section class="space-y-4">
        <button
          (click)="onCancel()"
          class="flex items-center gap-2 text-gray-400 hover:text-white transition"
        >
          <i class="pi pi-arrow-left"></i>
          <span>Back to Project Teams</span>
        </button>

        <div>
          <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold">Add Team to Project</h1>
          <p class="text-gray-400 mt-2">Select a team and assign roles for this project</p>
        </div>
      </section>

      @if (isLoading()) {
      <div class="flex justify-center items-center h-64">
        <app-loader />
      </div>
      } @else if (errorMessage()) {
      <div class="glass-card p-6 border border-red-500/50">
        <div class="flex items-center gap-3 text-red-400">
          <i class="pi pi-exclamation-triangle text-2xl"></i>
          <div>
            <h3 class="font-bold">Error</h3>
            <p class="text-sm">{{ errorMessage() }}</p>
          </div>
        </div>
      </div>
      } @else {
      <form [formGroup]="assignForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Select Team -->
        <div class="glass-card p-6 space-y-4">
          <h2 class="text-xl font-semibold text-primary">Select Team</h2>

          @if (teams().length > 0) {
          <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            @for (team of teams(); track team.id) {
            <div
              (click)="selectTeam(team.id!)"
              class="p-4 border rounded-lg cursor-pointer transition-all duration-300"
              [class.border-white]="selectedTeamId() !== team.id"
              [class.bg-white]="selectedTeamId() !== team.id"
              [class.border-primary]="selectedTeamId() === team.id"
              [class.bg-primary]="selectedTeamId() === team.id"
            >
              <div class="flex items-start gap-3">
                <div
                  class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0"
                  [class.bg-accent]="selectedTeamId() !== team.id"
                  [class.bg-primary]="selectedTeamId() === team.id"
                >
                  <i
                    class="pi pi-users text-lg"
                    [class.text-accent]="selectedTeamId() !== team.id"
                    [class.text-primary]="selectedTeamId() === team.id"
                  ></i>
                </div>
                <div class="flex-1 min-w-0">
                  <h3 class="font-bold truncate">{{ team.name }}</h3>
                  <p class="text-sm text-gray-400 truncate">{{ team.members.length }} members</p>
                </div>
                @if (selectedTeamId() === team.id) {
                <i class="pi pi-check text-primary text-xl flex-shrink-0"></i>
                }
              </div>
            </div>
            }
          </div>
          } @else {
          <div class="text-center py-8 border-2 border-dashed border-gray-800 rounded-lg">
            <i class="pi pi-users text-3xl text-gray-600 mb-3"></i>
            <p class="text-gray-400 mb-4">You don't have any teams yet</p>
            <button type="button" routerLink="/console/teams/create" class="outer-button text-sm">
              <i class="pi pi-plus mr-2"></i>
              Create Team
            </button>
          </div>
          }
        </div>

        <!-- Assign Roles -->
        @if (selectedTeam()) {
        <div class="glass-card p-6 space-y-4">
          <div>
            <h2 class="text-xl font-semibold text-primary">Assign Project Roles</h2>
            <p class="text-sm text-gray-400 mt-1">
              Select one or more roles for
              <span class="text-white font-medium">{{ selectedTeam()!.name }}</span> in this project
            </p>
          </div>

          <div class="grid gap-3 sm:grid-cols-2">
            @for (role of projectRoles; track role.value) {
            <label
              class="group flex items-start gap-3 p-4 border rounded-lg cursor-pointer transition-all duration-300 hover:bg-white/10"
              [ngClass]="{
                'border-white/10 bg-white/5': !isRoleSelected(role.value),
                'border-primary bg-primary/20 ring-2 ring-primary/30': isRoleSelected(role.value)
              }"
            >
              <div class="relative flex items-center justify-center mt-0.5">
                <input
                  type="checkbox"
                  [checked]="isRoleSelected(role.value)"
                  (change)="toggleRole(role.value)"
                  [id]="'role-' + role.value"
                  class="peer sr-only"
                />
                <div
                  class="w-5 h-5 rounded border-2 transition-all duration-200"
                  [ngClass]="{
                    'border-white/20 bg-white/5': !isRoleSelected(role.value),
                    'border-primary bg-primary': isRoleSelected(role.value)
                  }"
                >
                  @if (isRoleSelected(role.value)) {
                  <svg
                    class="w-full h-full text-white p-0.5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                      d="M5 13l4 4L19 7"
                    ></path>
                  </svg>
                  }
                </div>
              </div>
              <div class="flex-1">
                <div class="font-medium text-white group-hover:text-primary transition-colors">
                  {{ role.label }}
                </div>
                <div class="text-sm text-gray-400">{{ role.description }}</div>
              </div>
            </label>
            }
          </div>

          @if (assignForm.get('roles')?.hasError('minLength') && assignForm.get('roles')?.touched) {
          <p class="text-red-400 text-sm">Please select at least one role</p>
          }
        </div>
        }

        <!-- Actions -->
        @if (selectedTeam()) {
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
          <button
            type="button"
            (click)="onCancel()"
            class="flex-1 outer-button"
            [disabled]="isSubmitting()"
          >
            <i class="pi pi-times mr-2"></i>
            Cancel
          </button>
          <button
            type="submit"
            class="flex-1 inner-button"
            [disabled]="isSubmitting() || assignForm.invalid"
          >
            @if (isSubmitting()) {
            <i class="pi pi-spin pi-spinner mr-2"></i>
            Adding Team... } @else {
            <i class="pi pi-check mr-2"></i>
            Add Team to Project }
          </button>
        </div>
        }
      </form>
      }
    </main>
  </div>
</div>
