name: ðŸŽ¯ Smart Deploy - Auto-detect Changes (DEPRECATED - Use ci.yml instead)

# This workflow is deprecated. The smart deploy logic is now integrated in ci.yml
# Kept for reference only. To re-enable, uncomment the 'on' section below.
# on:
#   push:
#     branches:
#       - main
#       - dev
#       - master

on:
  workflow_dispatch:

jobs:
  detect-changes:
    name: ðŸ” Detect Changed Applications
    runs-on: ubuntu-latest
    outputs:
      api: ${{ steps.filter.outputs.api }}
      main-app: ${{ steps.filter.outputs.main-app }}
      chart: ${{ steps.filter.outputs.chart }}
      appgen: ${{ steps.filter.outputs.appgen }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Detect changes in applications
        uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            api:
              - 'apps/api/**'
            main-app:
              - 'apps/main-app/**'
            chart:
              - 'apps/chart/**'
            appgen:
              - 'apps/appgen/**'

  deploy-api:
    name: ðŸš€ Deploy API
    needs: detect-changes
    if: needs.detect-changes.outputs.api == 'true'
    uses: ./.github/workflows/deploy-api.yml
    secrets: inherit

  deploy-main-app:
    name: ðŸš€ Deploy Main App
    needs: detect-changes
    if: needs.detect-changes.outputs.main-app == 'true'
    uses: ./.github/workflows/deploy-main-app.yml
    secrets: inherit

  deploy-chart:
    name: ðŸš€ Deploy Chart
    needs: detect-changes
    if: needs.detect-changes.outputs.chart == 'true'
    uses: ./.github/workflows/deploy-chart.yml
    secrets: inherit

  summary:
    name: ðŸ“Š Deployment Summary
    runs-on: ubuntu-latest
    needs: [detect-changes]
    if: always()
    steps:
      - name: Display deployment summary
        run: |
          echo "## ðŸ“Š Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Applications Detected:" >> $GITHUB_STEP_SUMMARY
          echo "- **API**: ${{ needs.detect-changes.outputs.api == 'true' && 'âœ… Deployed' || 'â­ï¸ Skipped' }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Main App**: ${{ needs.detect-changes.outputs.main-app == 'true' && 'âœ… Deployed' || 'â­ï¸ Skipped' }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Chart**: ${{ needs.detect-changes.outputs.chart == 'true' && 'âœ… Deployed' || 'â­ï¸ Skipped' }}" >> $GITHUB_STEP_SUMMARY
          echo "- **AppGen**: ${{ needs.detect-changes.outputs.appgen == 'true' && 'âš ï¸ No deployment configured' || 'â­ï¸ Skipped' }}" >> $GITHUB_STEP_SUMMARY
